<!DOCTYPE html>
<html lang="vi">
<head>
   <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To√°n 6: Ba ƒëi·ªÉm th·∫≥ng h√†ng - Ch√¢n tr·ªùi s√°ng t·∫°o</title>
    
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], processEscapes: true },
            options: { enableMenu: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        :root {
            --primary: #2e7d32; /* Xanh l√° ƒë·∫≠m */
            --secondary: #455a64; 
            --accent: #f57c00; /* Cam n·ªïi b·∫≠t */
            --bg: #f1f8e9;
            --point-color: #d32f2f; 
            --line-color: #1976d2;
            --correct: #2e7d32; 
            --wrong: #c62828;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; line-height: 1.6; color: #333; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        
        .header { text-align: center; background: linear-gradient(135deg, var(--primary), #1b5e20); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; }

        .section-title { color: var(--primary); border-bottom: 3px solid var(--primary); display: inline-block; margin-top: 30px; padding-bottom: 5px; }
        .lesson-card { background: #fffde7; padding: 25px; border-radius: 15px; border-left: 10px solid #fbc02d; margin-bottom: 20px; }
        .info-box { background: white; padding: 20px; border-radius: 10px; border: 1px solid #e0e0e0; margin: 15px 0; box-shadow: inset 0 2px 5px rgba(0,0,0,0.02); }
        
        .static-img { text-align: center; margin: 20px 0; padding: 15px; background: #fafafa; border-radius: 10px; border: 1px solid #eee; }
        .img-label { font-size: 0.9rem; color: #666; font-style: italic; margin-top: 8px; }

        .sim-container { text-align: center; background: #263238; color: white; padding: 30px; border-radius: 20px; margin: 40px 0; }
        canvas { background: #fff; border-radius: 10px; max-width: 100%; border: 2px solid #546e7a; cursor: crosshair; }
        .slider-ui { width: 80%; margin: 25px auto; }

        #quiz-auth { text-align: center; padding: 40px; background: #e8f5e9; border-radius: 15px; border: 2px solid var(--primary); }
        .input-name { padding: 12px; width: 280px; border-radius: 8px; border: 2px solid var(--primary); font-size: 1rem; }
        #quiz-content { display: none; }
        .q-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid #eee; }
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px; }
        .option-btn { padding: 12px; border: 2px solid #dee2e6; border-radius: 10px; cursor: pointer; text-align: center; transition: 0.3s; }
        .option-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }
        
        .drop-zone { display: inline-block; width: 140px; height: 35px; border: 2px dashed #999; vertical-align: middle; border-radius: 8px; background: #f9f9f9; text-align: center; line-height: 35px; }
        .draggable { display: inline-block; padding: 5px 12px; background: var(--secondary); color: white; border-radius: 5px; cursor: grab; margin: 5px; }
        
        .ans-feedback { display: none; margin-top: 10px; font-weight: bold; }
        .btn { padding: 15px 40px; border: none; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 1.1rem; transition: 0.3s; }
        .btn-main { background: var(--primary); color: white; }
    </style>
</head>
<body>
<style>
    .header-wrapper {
        display: flex;
        align-items: center;
        padding: 20px;
        background: #0581be;
        position: relative; /* L√†m g·ªëc ƒë·ªÉ cƒÉn ch·ªânh */
        border-bottom: 2px solid #00adef; /* ƒê∆∞·ªùng k·∫ª xanh ƒë·∫∑c tr∆∞ng Ch√¢n tr·ªùi s√°ng t·∫°o */
    }

    .logo-img {
        width: 80px; 
        height: 80px; 
        border-radius: 50%; 
        border: 2px solid #eee;
        z-index: 2; /* ƒê·∫£m b·∫£o logo lu√¥n n·ªïi l√™n tr√™n */
    }

    .title-content {
        flex-grow: 1;      /* Chi·∫øm to√†n b·ªô kh√¥ng gian c√≤n l·∫°i */
        text-align: center; /* CƒÉn gi·ªØa n·ªôi dung ch·ªØ */
        margin-right: 80px; /* B√π l·∫°i kho·∫£ng c√°ch c·ªßa logo ƒë·ªÉ ch·ªØ n·∫±m ch√≠nh gi·ªØa m√†n h√¨nh */
    }

    .title-content h1 {
        margin: 0;
        font-size: 28px;
        color: #0ce73c; /* M√†u xanh ƒë·∫≠m chuy√™n nghi·ªáp */
        text-transform: uppercase;
    }

    .title-content p {
        margin: 5px 0 0 0;
        font-style: italic;
        color: #cef106;
    }
    .sim-tia { background: #eceff1; color: #263238; padding: 30px; border-radius: 20px; margin: 40px 0; border: 2px solid var(--primary); }
.status-box { 
    margin-top: 15px; padding: 15px; border-radius: 10px; font-weight: bold; font-size: 1.2rem;
    transition: all 0.3s ease;
}
.status-doi { background: var(--correct); color: white; box-shadow: 0 0 20px rgba(46, 125, 50, 0.4); }
.status-thuong { background: #cfd8dc; color: #546e7a; }
</style>

<div class="header-wrapper">
    <img src="https://lh3.googleusercontent.com/u/0/d/1pvgGXoH3PeMQsKQz1SN7R02gTudoNvHR" 
         alt="Logo" 
         class="logo-img">
    
    <div class="title-content">
        <h1>üìç B√ÄI 3: HAI ƒê∆Ø·ªúNG TH·∫≤NG C·∫ÆT NHAU, SONG SONG. TIA</h1>
        <p>Ng∆∞·ªùi bi√™n so·∫°n: Ph·∫°m Th·ªã Xu√¢n</p>
    </div>
</div>
<h2 class="section-title">1. Hai ƒë∆∞·ªùng th·∫≥ng c·∫Øt nhau, song song, tr√πng nhau</h2>
    <div class="lesson-card" style="border-left-color: #5e72e4;">
        <div class="info-box">
            <ul>
                <li><b>Hai ƒë∆∞·ªùng th·∫≥ng c·∫Øt nhau:</b> L√† hai ƒë∆∞·ªùng th·∫≥ng ch·ªâ c√≥ <b>m·ªôt ƒëi·ªÉm chung</b>. ƒêi·ªÉm chung ƒë√≥ g·ªçi l√† giao ƒëi·ªÉm.</li>
                <li><b>Hai ƒë∆∞·ªùng th·∫≥ng song song:</b> L√† hai ƒë∆∞·ªùng th·∫≥ng <b>kh√¥ng c√≥ ƒëi·ªÉm chung</b> n√†o (d√π k√©o d√†i m√£i v·ªÅ hai ph√≠a).</li>
                <li><b>Hai ƒë∆∞·ªùng th·∫≥ng tr√πng nhau:</b> L√† hai ƒë∆∞·ªùng th·∫≥ng c√≥ <b>v√¥ s·ªë ƒëi·ªÉm chung</b>.</li>
            </ul>
            <p><i>L∆∞u √Ω:</i> Hai ƒë∆∞·ªùng th·∫≥ng kh√¥ng tr√πng nhau ƒë∆∞·ª£c g·ªçi l√† hai ƒë∆∞·ªùng th·∫≥ng ph√¢n bi·ªát.</p>
        </div>
        
        

[Image of intersecting and parallel lines]

        
        <div class="static-img">
            <svg width="600" height="150">
                <line x1="50" y1="20" x2="150" y2="100" stroke="var(--line-color)" stroke-width="2" />
                <line x1="50" y1="100" x2="150" y2="20" stroke="var(--accent)" stroke-width="2" />
                <circle cx="100" cy="60" r="3" fill="black" />
                <text x="80" y="130" font-weight="bold">C·∫Øt nhau t·∫°i O</text>

                <line x1="250" y1="40" x2="400" y2="40" stroke="var(--line-color)" stroke-width="2" />
                <line x1="250" y1="70" x2="400" y2="70" stroke="var(--line-color)" stroke-width="2" />
                <text x="280" y="130" font-weight="bold">Song song (a // b)</text>

                <line x1="480" y1="55" x2="580" y2="55" stroke="var(--line-color)" stroke-width="4" opacity="0.5"/>
                <line x1="480" y1="55" x2="580" y2="55" stroke="var(--line-color)" stroke-width="1" />
                <text x="500" y="130" font-weight="bold">Tr√πng nhau</text>
            </svg>
            <div class="img-label">H√¨nh 1: V·ªã tr√≠ t∆∞∆°ng ƒë·ªëi c·ªßa hai ƒë∆∞·ªùng th·∫≥ng ph√¢n bi·ªát</div>
        </div>
    </div>
    <h2 class="section-title">3. Kh√°i ni·ªám v·ªÅ Tia</h2>
    <div class="lesson-card">
        <div class="info-box">
            <ul>
                <li>ƒêi·ªÉm $O$ chia ƒë∆∞·ªùng th·∫≥ng th√†nh hai ph·∫ßn, m·ªói ph·∫ßn c√πng v·ªõi ƒëi·ªÉm $O$ g·ªçi l√† m·ªôt <b>tia g·ªëc $O$</b>.</li>
                <li><b>T√™n g·ªçi:</b> Khi vi·∫øt t√™n m·ªôt tia, ta ph·∫£i vi·∫øt t√™n <b>ƒëi·ªÉm g·ªëc tr∆∞·ªõc</b>. </li>
                <li><i>V√≠ d·ª•:</i> Tia $Ox$ (g·ªëc l√† $O$), tia $AB$ (g·ªëc l√† $A$).</li>
            </ul>
        </div>
        <div class="static-img">
            <svg width="400" height="100">
                <line x1="50" y1="50" x2="350" y2="50" stroke="#ccc" stroke-width="1" stroke-dasharray="4" />
                <line x1="150" y1="50" x2="350" y2="50" stroke="var(--line-color)" stroke-width="3" />
                <circle cx="150" cy="50" r="4" fill="black" /> 
                <text x="145" y="40" font-weight="bold" font-family="Times New Roman" font-style="italic">O</text>
                <text x="340" y="40" font-family="Times New Roman" font-style="italic">x</text>
                <text x="150" y="85" fill="var(--primary)" font-weight="bold">Tia $Ox$ (G·ªëc $O$)</text>
            </svg>
            <div class="img-label">H√¨nh 2: H√¨nh ·∫£nh tia $Ox$ - kh√¥ng gi·ªõi h·∫°n v·ªÅ ph√≠a $x$</div>
        </div>
    </div>

    <h2 class="section-title">4. Hai tia ƒë·ªëi nhau v√† Hai tia tr√πng nhau</h2>
    <div class="lesson-card">
        <div class="info-box">
            <ul>
                <li><b>Hai tia ƒë·ªëi nhau:</b> Hai tia chung g·ªëc v√† t·∫°o th√†nh m·ªôt ƒë∆∞·ªùng th·∫≥ng.</li>
                <li><b>Hai tia tr√πng nhau:</b> V√≠ d·ª• ƒëi·ªÉm $B$ thu·ªôc tia $Ax$, khi ƒë√≥ tia $AB$ v√† tia $Ax$ l√† hai tia tr√πng nhau.</li>
            </ul>
        </div>
        <div class="static-img">
            <svg width="550" height="140">
                <line x1="50" y1="50" x2="250" y2="50" stroke="var(--line-color)" stroke-width="2" />
                <circle cx="150" cy="50" r="4" fill="black" />
                <text x="145" y="40" font-style="italic">O</text> <text x="45" y="40" font-style="italic">y</text> <text x="245" y="40" font-style="italic">x</text>
                <text x="60" y="80" font-size="14" font-weight="bold">$Ox$ v√† $Oy$ l√† hai tia ƒë·ªëi nhau</text>

                <line x1="320" y1="50" x2="520" y2="50" stroke="#1976d2" stroke-width="2" />
                <circle cx="340" cy="50" r="4" fill="black" /> <text x="335" y="40" font-style="italic">A</text>
                <circle cx="430" cy="50" r="4" fill="black" /> <text x="425" y="40" font-style="italic">B</text>
                <text x="515" y="40" font-style="italic">x</text>
                <text x="330" y="80" font-size="14" font-weight="bold">Tia $AB$ v√† tia $Ax$ tr√πng nhau</text>
            </svg>
            <div class="img-label">H√¨nh 3: Ph√¢n bi·ªát quan h·ªá gi·ªØa c√°c tia</div>
        </div>
    </div>
    <div class="sim-container" style="background: #fdfefe; color: #333; border: 2px solid var(--line-color);">
    <h2 style="color: var(--line-color);">üìê TH·ª∞C NGHI·ªÜM: V·ªä TR√ç T∆Ø∆†NG ƒê·ªêI</h2>
    <p>D√πng thanh tr∆∞·ª£t ƒë·ªÉ quay ƒë∆∞·ªùng th·∫≥ng m√†u cam. Quan s√°t s·ª± thay ƒë·ªïi gi·ªØa <b>Song song</b> v√† <b>C·∫Øt nhau</b>.</p>
    
    <canvas id="lineSimCanvas" width="540" height="300" style="background: #fff; border: 1px solid #ccc;"></canvas>
    
    <div class="slider-ui">
        <input type="range" id="lineAngleSlider" min="-10" max="45" value="0" style="width: 100%;">
        <div id="lineStatus" class="status-box" style="margin-top:20px; text-align:center;">Tr·∫°ng th√°i: ƒêang song song</div>
    </div>
</div>

<div class="sim-container" style="background: #263238; color: white; padding: 30px; border-radius: 20px; margin: 40px 0; text-align: center;">
    <h2>üîÑ TH·ª∞C NGHI·ªÜM: HAI TIA ƒê·ªêI NHAU</h2>
    <p>K√©o thanh tr∆∞·ª£t ƒë·ªÉ thay ƒë·ªïi v·ªã tr√≠ tia $Ay$. Khi n√†o ch√∫ng t·∫°o th√†nh m·ªôt ƒë∆∞·ªùng th·∫≥ng?</p>
    
    <canvas id="oppRayCanvas" width="540" height="350" style="background: #fff; border-radius: 10px; max-width: 100%; display: block; margin: 0 auto;"></canvas>
    
    <div class="slider-ui" style="width: 80%; margin: 25px auto;">
        <input type="range" id="oppRaySlider" min="0" max="180" value="60" style="width: 100%;">
        <h2 id="oppRayReadout" style="color: #ffeb3b; margin-top: 15px;">Ax v√† Ay KH√îNG ƒê·ªêI NHAU</h2>
    </div>
</div>
   
    <div id="quiz-auth">
        <h2>üìù B√ÄI T·∫¨P C·ª¶NG C·ªê</h2>
        <p>H·ªçc sinh nh·∫≠p t√™n ƒë·ªÉ h·ªá th·ªëng ghi nh·∫≠n k·∫øt qu·∫£</p>
        <input type="text" id="userName" class="input-name" placeholder="H·ªç v√† t√™n..."><br><br>
        <button class="btn btn-main" onclick="startQuiz()">B·∫ÆT ƒê·∫¶U</button>
    </div>

    <div id="quiz-content">
        <div style="display:flex; justify-content: space-between; padding: 15px; background: var(--secondary); color:white; border-radius: 10px; margin-bottom: 20px;">
            <span>H·ªçc sinh: <b id="stName"></b></span>
            <span>‚è± <b id="timeClock">10:00</b></span>
        </div>
        <div id="quiz-list"></div>
        <button class="btn btn-main" id="subBtn" onclick="finishQuiz()" style="display:block; margin: 40px auto; background: var(--accent);">N·ªòP B√ÄI</button>
        <div id="final-result" style="text-align:center; font-size: 2rem; font-weight: bold; margin-bottom: 50px;"></div>
    </div>
</div>

<script>

// --- KH·ªûI T·∫†O T·ªîNG TH·ªÇ ---
window.addEventListener('load', function() {
    initOppositeRays(); // Kh·ªüi ch·∫°y m√¥ ph·ªèng Tia ƒë·ªëi
    // N·∫øu c√¥ c√≥ d√πng protractor (m√°y ƒëo g√≥c), h√£y b·ªè comment d√≤ng d∆∞·ªõi
    // initProtractor(); 
});
function initLineRelation() {
    const canvas = document.getElementById('lineSimCanvas');
    const slider = document.getElementById('lineAngleSlider');
    const status = document.getElementById('lineStatus');
    const ctx = canvas.getContext('2d');

    function draw() {
        const angle = parseInt(slider.value);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // ƒê∆∞·ªùng th·∫≥ng a (C·ªë ƒë·ªãnh)
        ctx.strokeStyle = "#1976d2"; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(50, 100); ctx.lineTo(490, 100); ctx.stroke();
        ctx.fillStyle = "#1976d2"; ctx.fillText("ƒë∆∞·ªùng th·∫≥ng a", 400, 90);

        // ƒê∆∞·ªùng th·∫≥ng b (Quay quanh t√¢m gi·∫£ ƒë·ªãnh)
        ctx.save();
        ctx.translate(270, 180); // T√¢m quay
        ctx.rotate(angle * Math.PI / 180);
        ctx.strokeStyle = "#f57c00"; ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(-220, 0); ctx.lineTo(220, 0); ctx.stroke();
        ctx.fillStyle = "#f57c00"; ctx.fillText("ƒë∆∞·ªùng th·∫≥ng b", 100, -15);
        ctx.restore();

        // C·∫≠p nh·∫≠t tr·∫°ng th√°i
        if (angle === 0) {
            status.innerText = "Tr·∫°ng th√°i: HAI ƒê∆Ø·ªúNG TH·∫≤NG SONG SONG (a // b) ‚úÖ";
            status.style.background = "#e8f5e9";
            status.style.color = "#2e7d32";
        } else {
            status.innerText = "Tr·∫°ng th√°i: HAI ƒê∆Ø·ªúNG TH·∫≤NG C·∫ÆT NHAU ‚ùå";
            status.style.background = "#fff3e0";
            status.style.color = "#ef6c00";
        }
    }

    slider.oninput = draw;
    draw();
}
window.addEventListener('load', initLineRelation);
// --- CH·ª®C NƒÇNG M√î PH·ªéNG TIA ƒê·ªêI ---
function initOppositeRays() {
    const canvas = document.getElementById('oppRayCanvas');
    const slider = document.getElementById('oppRaySlider');
    const readout = document.getElementById('oppRayReadout');
    
    if(!canvas || !slider) return;
    const ctx = canvas.getContext('2d');

    function draw(angle) {
        // cx, cy l√† t√¢m ƒëi·ªÉm A. cy = 175 gi√∫p A n·∫±m gi·ªØa khung cao 350px
        const cx = 270;
        const cy = 175; 
        const r = 180;
        const rad = angle * Math.PI / 180;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // V·∫Ω tr·ª•c n·ªÅn m·ªù
        ctx.setLineDash([5, 5]);
        ctx.strokeStyle = "#e0e0e0"; ctx.lineWidth = 1;
        ctx.beginPath(); ctx.moveTo(cx - r, cy); ctx.lineTo(cx + r, cy); ctx.stroke();
        ctx.setLineDash([]);

        // V·∫Ω Tia Ax (M√†u ƒëen, c·ªë ƒë·ªãnh sang tr√°i)
        ctx.lineWidth = 5; ctx.strokeStyle = "#333"; ctx.lineCap = "round";
        ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(cx - r, cy); ctx.stroke();
        ctx.fillStyle = "#333"; ctx.font = "italic bold 24px 'Times New Roman'";
        ctx.fillText("x", cx - r - 30, cy + 10);

        // V·∫Ω Tia Ay (M√†u xanh, xoay theo slider)
        const targetX = cx + r * Math.cos(Math.PI - rad);
        const targetY = cy - r * Math.sin(Math.PI - rad);
        
        ctx.strokeStyle = (angle == 180) ? "#2e7d32" : "#1976d2";
        ctx.beginPath(); ctx.moveTo(cx, cy); ctx.lineTo(targetX, targetY); ctx.stroke();
        ctx.fillStyle = ctx.strokeStyle;
        ctx.fillText("y", targetX + 15, targetY + 10);

        // V·∫Ω G·ªëc A
        ctx.beginPath(); ctx.arc(cx, cy, 8, 0, Math.PI * 2);
        ctx.fillStyle = "#000"; ctx.fill();
        ctx.font = "bold italic 26px 'Times New Roman'";
        ctx.fillText("A", cx - 10, cy - 25);

        // C·∫≠p nh·∫≠t n·ªôi dung th√¥ng b√°o theo y√™u c·∫ßu
        if (angle == 180) {
            readout.innerText = "Ax v√† Ay l√† hai tia ƒë·ªëi nhau ‚úÖ";
            readout.style.color = "#4caf50"; // M√†u xanh l√° khi ƒë√∫ng
        } else {
            readout.innerText = "Ax v√† Ay kh√¥ng ƒë·ªëi nhau ‚ùå";
            readout.style.color = "#ffeb3b"; // M√†u v√†ng khi ch∆∞a ƒë·ªëi
        }
    }

    slider.oninput = () => draw(slider.value);
    draw(slider.value);
}

// --- H·ªÜ TH·ªêNG QUIZ ---
const quizData = [
    { id: 1, type: 'mcq', text: 'T√™n c·ªßa m·ªôt tia ƒë∆∞·ª£c ƒë·∫∑t theo th·ª© t·ª± n√†o?', opts: ['G·ªëc tr∆∞·ªõc, ng·ªçn sau', 'Ng·ªçn tr∆∞·ªõc, g·ªëc sau', 'Th·ª© t·ª± t√πy √Ω'], corr: 0 },
    { id: 2, type: 'mcq', text: 'Hai tia $Ox$ v√† $Oy$ ƒë∆∞·ª£c g·ªçi l√† ƒë·ªëi nhau khi ch√∫ng t·∫°o th√†nh:', opts: ['M·ªôt g√≥c vu√¥ng', 'M·ªôt ƒë∆∞·ªùng th·∫≥ng', 'M·ªôt h√¨nh tam gi√°c'], corr: 1 },
    { id: 3, type: 'drag', text: 'Tia g·ªëc $A$ ƒëi qua ƒëi·ªÉm $B$ ƒë∆∞·ª£c k√Ω hi·ªáu l√† tia:', opts: ['$AB$', '$BA$'], corr: '$AB$' },
    { id: 4, type: 'mcq', text: 'Tr√™n ƒë∆∞·ªùng th·∫≥ng $xy$, l·∫•y ƒëi·ªÉm $M$. Hai tia ƒë·ªëi nhau l√†:', opts: ['Tia $Mx$ v√† $My$', 'Tia $xy$ v√† $yx$', 'Tia $xM$ v√† $yM$'], corr: 0 },
    { id: 5, type: 'mcq', text: 'Tia $Am$ l√† h√¨nh g·ªìm ƒëi·ªÉm $A$ v√†:', opts: ['To√†n b·ªô ƒë∆∞·ªùng th·∫≥ng', 'M·ªôt ph·∫ßn ƒë∆∞·ªùng th·∫≥ng b·ªã chia ra b·ªüi $A$', 'Hai ƒëi·ªÉm $A$ v√† $m$'], corr: 1 },
    { id: 6, type: 'drag', text: 'N·∫øu $K$ n·∫±m gi·ªØa $I$ v√† $H$, th√¨ tia $KI$ v√† $KH$ l√† hai tia:', opts: ['tr√πng nhau', 'ƒë·ªëi nhau'], corr: 'ƒë·ªëi nhau' },
    { id: 7, type: 'mcq', text: 'M·ªôt tia c√≥ ƒë·ªô d√†i l√† bao nhi√™u?', opts: ['Kh√¥ng ƒëo ƒë∆∞·ª£c (v√¥ h·∫°n)', '10 cm', 'Ph·ª• thu·ªôc v√†o th∆∞·ªõc k·∫ª'], corr: 0 }
];

let userAnswers = {};
let timer;

function startQuiz() {
    const name = document.getElementById('userName').value;
    if(!name) return alert("Em h√£y nh·∫≠p h·ªç t√™n nh√©!");
    document.getElementById('quiz-auth').style.display = 'none';
    document.getElementById('quiz-content').style.display = 'block';
    document.getElementById('stName').innerText = name;
    renderQuiz();
    
    let t = 600;
    timer = setInterval(() => {
        t--; 
        let m = Math.floor(t/60), s = t%60;
        document.getElementById('timeClock').innerText = `${m}:${s<10?'0'+s:s}`;
        if(t<=0) finishQuiz();
    }, 1000);
}

function renderQuiz() {
    const container = document.getElementById('quiz-list');
    container.innerHTML = "";
    quizData.forEach((q, i) => {
        let div = document.createElement('div');
        div.className = 'q-card';
        div.id = `card_${q.id}`;
        let html = `<b>C√¢u ${i+1}:</b> ${q.text}<br>`;
        if(q.type === 'mcq') {
            html += `<div class="options-grid">`;
            q.opts.forEach((o, idx) => {
                html += `<div class="option-btn" onclick="selectMCQ(${q.id}, ${idx})" id="opt_${q.id}_${idx}">${o}</div>`;
            });
            html += `</div>`;
        } else {
            html += `<div style="margin-top:10px;"><div class="drop-zone" id="dz_${q.id}">Th·∫£ v√†o ƒë√¢y</div> `;
            q.opts.forEach(o => {
                let cleanId = btoa(unescape(encodeURIComponent(o))).replace(/=/g,''); 
                html += `<div class="draggable" draggable="true" id="dg_${q.id}_${cleanId}" data-v="${o}">${o}</div>`;
            });
            html += `</div>`;
        }
        html += `<div class="ans-feedback" id="fb_${q.id}"></div>`;
        div.innerHTML = html;
        container.appendChild(div);
    });
    if (window.MathJax) MathJax.typesetPromise();
    initDrag();
}

function selectMCQ(qId, idx) {
    userAnswers[qId] = idx;
    document.querySelectorAll(`#card_${qId} .option-btn`).forEach(b => b.classList.remove('selected'));
    document.getElementById(`opt_${qId}_${idx}`).classList.add('selected');
}

function initDrag() {
    document.querySelectorAll('.draggable').forEach(d => d.ondragstart = e => e.dataTransfer.setData('text', e.target.id));
    document.querySelectorAll('.drop-zone').forEach(z => {
        z.ondragover = e => e.preventDefault();
        z.ondrop = e => {
            e.preventDefault();
            const id = e.dataTransfer.getData('text');
            if(id.includes(`dg_${z.id.split('_')[1]}`)) {
                z.innerHTML = ""; z.appendChild(document.getElementById(id));
            }
        }
    });
}

function finishQuiz() {
    clearInterval(timer);
    let score = 0;
    quizData.forEach(q => {
        let isCorrect = false;
        let feedback = document.getElementById(`fb_${q.id}`);
        if(q.type === 'mcq') {
            if(userAnswers[q.id] === q.corr) isCorrect = true;
        } else {
            const zone = document.getElementById(`dz_${q.id}`);
            if(zone.children.length > 0 && zone.children[0].dataset.v === q.corr) isCorrect = true;
        }
        feedback.style.display = 'block';
        if(isCorrect) {
            score++; feedback.innerHTML = "<span style='color:green'>‚úì ƒê√∫ng r·ªìi!</span>";
            document.getElementById(`card_${q.id}`).style.borderLeft = "10px solid green";
        } else {
            feedback.innerHTML = `<span style='color:red'>‚úó Sai. ƒê√°p √°n: ${q.type==='mcq'?q.opts[q.corr]:q.corr}</span>`;
            document.getElementById(`card_${q.id}`).style.borderLeft = "10px solid red";
        }
    });
    document.getElementById('final-result').innerText = `K·∫æT QU·∫¢: ${score} / ${quizData.length}`;
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
}
</script>
</body>
</html>
